(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,a)=>{t.exports=e.r(76562)},38036,e=>{"use strict";let t="auth_token",a="auth_user",l={setAuth:(e,l)=>{localStorage.setItem(t,e),localStorage.setItem(a,JSON.stringify(l))},getToken:()=>localStorage.getItem(t),getUser:()=>{let e=localStorage.getItem(a);if(!e)return null;try{return JSON.parse(e)}catch{return null}},isAuthenticated:()=>!!l.getToken(),clearAuth:()=>{localStorage.removeItem(t),localStorage.removeItem(a)},getAuthHeader:()=>{let e=l.getToken();return e?{Authorization:`Bearer ${e}`}:{}}};e.s(["USER_ROLES",0,{ADMIN:"admin",MANAGER:"manager",USER:"user"},"authUtils",0,l])},61664,e=>{"use strict";let t=e.i(47167).default.env.NEXT_PUBLIC_API_URL??"http://localhost:3000";e.s(["BASE_URL",0,t])},93526,e=>{"use strict";var t=e.i(71645),a=e.i(18566),l=e.i(38036);e.s(["useRequireAuth",0,e=>{let n=(0,a.useRouter)(),[r,c]=(0,t.useState)(null);return(0,t.useEffect)(()=>{let t=l.authUtils.getUser();(c(t),l.authUtils.isAuthenticated())?e?.allowedRoles&&t?.role&&(e.allowedRoles.includes(t.role)||(t.role===l.USER_ROLES.ADMIN?n.replace("/dashboard/admin"):n.replace("/dashboard/user"))):n.replace("/login")},[e?.allowedRoles,n]),r}])},16802,e=>{"use strict";var t=e.i(71645),a=e.i(18566),l=e.i(38036),n=e.i(61664),r=e.i(93526);let c=e=>e.toLocaleDateString("vi-VN",{weekday:"long",day:"2-digit",month:"long",year:"numeric"}),i=e=>new Date(e).toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}),s=e=>{if(null==e)return"0h";let t="string"==typeof e?parseFloat(e):e;return Number.isNaN(t)?"0h":`${t.toFixed(2)}h`},m={display:"flex",flexDirection:"column",gap:"12px",alignItems:"flex-end"},o=(0,t.memo)(({attendance:e})=>(0,t.createElement)("tr",null,(0,t.createElement)("td",null,c(new Date(e.workDate))),(0,t.createElement)("td",null,e.checkInTime?i(e.checkInTime):"--"),(0,t.createElement)("td",null,e.checkOutTime?i(e.checkOutTime):"--"),(0,t.createElement)("td",null,s(e.totalHours)),(0,t.createElement)("td",null,(0,t.createElement)("span",{className:`ritzy-badge ${e.status}`},e.status))));o.displayName="HistoryRow",e.s(["default",0,()=>{let e=(0,a.useRouter)(),u=(0,r.useRequireAuth)(),[h,d]=(0,t.useState)(()=>new Date),[g,y]=(0,t.useState)(()=>new Date),E=(0,t.useRef)(new Date().toDateString()),[p,N]=(0,t.useState)(null),[k,b]=(0,t.useState)([]),[v,f]=(0,t.useState)(!1),[S,w]=(0,t.useState)(!1),[T,z]=(0,t.useState)(!1),[C,A]=(0,t.useState)(!1),[R,U]=(0,t.useState)(null),x=(0,t.useRef)(null),I=(0,t.useMemo)(()=>h.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),[h]),O=(0,t.useMemo)(()=>c(g),[g]),B=(0,t.useCallback)(e=>{x.current&&(window.clearTimeout(x.current),x.current=null),U(e),e&&(x.current=window.setTimeout(()=>{U(null),x.current=null},3200))},[]);(0,t.useEffect)(()=>()=>{x.current&&window.clearTimeout(x.current)},[]),(0,t.useEffect)(()=>{let e=window.setInterval(()=>{let e=new Date;d(e);let t=e.toDateString();t!==E.current&&(E.current=t,y(e))},6e4);return()=>window.clearInterval(e)},[]),(0,t.useEffect)(()=>{u||e.replace("/login")},[u,e]);let L=(0,t.useCallback)(async()=>{if(u){f(!0);try{let e=await fetch(`${n.BASE_URL}/api/attendance/today`,{headers:{...l.authUtils.getAuthHeader(),"Content-Type":"application/json"}});if(!e.ok)return;let t=await e.json();N(t.data??null)}catch(e){console.error("Error fetching today attendance:",e)}finally{f(!1)}}},[u]),D=(0,t.useCallback)(async()=>{if(u){w(!0);try{let e=await fetch(`${n.BASE_URL}/api/attendance/history?limit=10`,{headers:{...l.authUtils.getAuthHeader(),"Content-Type":"application/json"}});if(!e.ok)return;let t=await e.json();b(t.data??[])}catch(e){console.error("Error fetching attendance history:",e)}finally{w(!1)}}},[u]);(0,t.useEffect)(()=>{u&&L()},[u,L]),(0,t.useEffect)(()=>{C&&u&&D()},[C,u,D]);let $=(0,t.useCallback)(()=>{l.authUtils.clearAuth(),e.replace("/login")},[e]),_=(0,t.useCallback)(async()=>{if(!u||p)return void B({type:"error",text:"Bạn đã chấm công vào hôm nay rồi"});z(!0);try{let e=await fetch(`${n.BASE_URL}/api/attendance/checkin`,{method:"POST",headers:{...l.authUtils.getAuthHeader(),"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.message??"Không thể chấm công vào");B({type:"success",text:"Chấm công vào thành công!"}),await L(),C&&await D()}catch(e){B({type:"error",text:e instanceof Error?e.message:"Đã xảy ra lỗi khi chấm công vào"})}finally{z(!1)}},[u,p,B,L,D,C]),H=(0,t.useCallback)(async()=>{if(u){if(!p)return void B({type:"error",text:"Bạn chưa chấm công vào hôm nay"});if(p.checkOutTime)return void B({type:"error",text:"Bạn đã chấm công ra hôm nay rồi"});z(!0);try{let e=await fetch(`${n.BASE_URL}/api/attendance/checkout`,{method:"POST",headers:{...l.authUtils.getAuthHeader(),"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.message??"Không thể chấm công ra");B({type:"success",text:"Chấm công ra thành công!"}),await L(),C&&await D()}catch(e){B({type:"error",text:e instanceof Error?e.message:"Đã xảy ra lỗi khi chấm công"})}finally{z(!1)}}},[u,p,B,L,D,C]),j=(0,t.useCallback)(()=>{A(e=>!e)},[]),M=(0,t.useMemo)(()=>[{label:"Check-in",value:p?.checkInTime?i(p.checkInTime):"--/--"},{label:"Check-out",value:p?.checkOutTime?i(p.checkOutTime):"--/--"},{label:"Tổng giờ",value:s(p?.totalHours)},{label:"Ngày làm",value:O}],[p,O]);return(0,t.createElement)("div",{className:"ritzy-dashboard"},(0,t.createElement)("div",{className:"ritzy-shell"},(0,t.createElement)("header",{className:"ritzy-top-bar"},(0,t.createElement)("div",null,(0,t.createElement)("p",{className:"ritzy-brand"},"Chấm công Bình Boong"),(0,t.createElement)("p",{className:"ritzy-subtitle"},"Một ngày làm việc vui vẻ hoặc không"),u?(0,t.createElement)("p",{className:"ritzy-greeting"},"Xin chào, ",u.fullName??u.username):null),(0,t.createElement)("div",{style:m},(0,t.createElement)("span",{className:"ritzy-calendar-chip"},O),(0,t.createElement)("button",{className:"ritzy-btn",onClick:$},"Đăng xuất"))),R?(0,t.createElement)("div",{className:`ritzy-alert ${R.type}`},R.text):null,(0,t.createElement)("div",{className:"ritzy-content-grid"},(0,t.createElement)("section",{className:"ritzy-hero"},(0,t.createElement)("p",{className:"ritzy-hero-kicker"},"Thời gian hệ thống:"),(0,t.createElement)("div",{className:"ritzy-hero-clock"},I),(0,t.createElement)("p",{className:"ritzy-hero-caption"},"Đồng hồ chấm công"),(0,t.createElement)("div",{className:"ritzy-hero-meta"},(0,t.createElement)("span",null,O),(0,t.createElement)("span",null,p?"Sẵn sàng hoàn tất ngày làm việc":"Đã đến giờ bắt đầu ngày mới"),p?.checkInTime?(0,t.createElement)("span",null,`Đ\xe3 check-in: ${i(p.checkInTime)}`):null)),(0,t.createElement)("section",{className:"ritzy-panel"},(0,t.createElement)("div",{className:"ritzy-panel-header"},(0,t.createElement)("div",null,(0,t.createElement)("p",{className:"ritzy-overline"},"Hôm nay"),(0,t.createElement)("h2",{className:"ritzy-panel-title"},"Trạng thái làm việc"))),v?(0,t.createElement)("p",{className:"ritzy-placeholder"},"Đang tải thông tin hôm nay..."):(0,t.createElement)("div",{className:"user-status-grid"},M.map(e=>(0,t.createElement)("div",{key:e.label,className:"user-status-row"},(0,t.createElement)("span",null,e.label),(0,t.createElement)("strong",null,e.value)))))),(0,t.createElement)("div",{className:"ritzy-grid"},(0,t.createElement)("article",{className:`ritzy-action-card ${p?"disabled":""}`,"aria-disabled":!!p},(0,t.createElement)("h3",null,"Chấm công vào"),(0,t.createElement)("p",null,"Ghi nhận thời điểm bắt đầu làm việc trong ngày."),(0,t.createElement)("button",{className:"ritzy-btn block",onClick:_,disabled:!!p||T},T?"Đang xử lý...":"Chấm công vào")),(0,t.createElement)("article",{className:`ritzy-action-card ${!p||p.checkOutTime?"disabled":""}`,"aria-disabled":!p||!!p?.checkOutTime},(0,t.createElement)("h3",null,"Chấm công ra"),(0,t.createElement)("p",null,"Hoàn tất phiên làm việc và tính tổng giờ."),(0,t.createElement)("button",{className:"ritzy-btn block",onClick:H,disabled:!p||!!p.checkOutTime||T},T?"Đang xử lý...":"Chấm công ra")),(0,t.createElement)("article",{className:"ritzy-action-card"},(0,t.createElement)("h3",null,"Lịch sử chấm công"),(0,t.createElement)("p",null,"Xem 10 bản ghi gần nhất của bạn."),(0,t.createElement)("button",{className:"ritzy-btn ghost block",onClick:j},C?"Thu gọn lịch sử":"Xem lịch sử"))),C?(0,t.createElement)("section",{className:"ritzy-history"},(0,t.createElement)("header",null,(0,t.createElement)("div",null,(0,t.createElement)("p",{className:"ritzy-overline"},"Lịch sử"),(0,t.createElement)("h2",{className:"ritzy-panel-title"},"Nhật ký chấm công")),(0,t.createElement)("span",{className:"ritzy-calendar-chip"},`${k.length} bản ghi`)),S?(0,t.createElement)("p",{className:"ritzy-placeholder"},"Đang tải lịch sử..."):0===k.length?(0,t.createElement)("p",{className:"ritzy-placeholder"},"Bạn chưa có lịch sử chấm công."):(0,t.createElement)("div",{className:"ritzy-table-wrapper"},(0,t.createElement)("table",{className:"ritzy-history-table"},(0,t.createElement)("thead",null,(0,t.createElement)("tr",null,(0,t.createElement)("th",null,"Ngày"),(0,t.createElement)("th",null,"Check-in"),(0,t.createElement)("th",null,"Check-out"),(0,t.createElement)("th",null,"Tổng giờ"),(0,t.createElement)("th",null,"Trạng thái"))),(0,t.createElement)("tbody",null,k.map(e=>(0,t.createElement)(o,{key:e.id,attendance:e})))))):null))},"dynamic",0,"force-dynamic"])}]);